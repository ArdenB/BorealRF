1) Create uniform files for each database
Each dataset has a unique R script called "XX_consolidate_check.R", where "XX" is the province abbreviation or CAFI/CIPHA. These scripts are written to extract the data from whatever unique format that organization happens to use and to create between 2 and 4 extra sets of data. The first set of data (which is created for each) is a series of "check" files. These are in the folder "XX/checks/" and there is a unique one for each PSP. These files have a row that corresponds with each tree measured in the PSP, and a column for the species, dbh, and state (alive/dead) at each measurement date. The species indicator is a numeric key common across all databases and can be found in "SP_LUT.csv". In addition, there is a column for the plot size (in ha) for each PSP. Many of these scripts include loops that attempt to correct errors in species ID, dbh measurements or state (or some combination of all) using some assumptions listed in the scripts. In addition to these "check" files, each script produces a "XX_surveys.csv" file which lists the years that each PSP was measured and relates the "t1","t2",etc. headers in the "check" files to actual dates. Some databases included some combination of damage/harvest/disturbance codes, which were at the tree level. If these data existed, 1 or 2 files were written, "XX_cut_percent.csv" and/or "XX_flags_percent.csv" which list the percent of trees at each PSP that were either cut or damaged by various other categories of disturbances between measurement dates.

2) Consolidate "XX_surveys.csv"s
Using the script "survey_years.R", combine all survey date csvs into a single one with the dates of measurements.

3) Create consolidated databases
This is where the bulk of the calculations occur. The script "PSP_consolidate.R" takes the data in each PSP's "check" file, calculates the biomass for each tree at each measurement date using allometric equations defined at the beginning, creates a unique "biomass" file for each PSP, calculates the total live biomass and stemcount, biomass growth, recruitment by biomass and stemcount, and mortality by biomass and stemcount, and creates a bunch of csvs in "EWS/data/psp/" which have these data, these data split out by species, and some reference tables. Each database has a unique minimum dbh threshold to be considered a tree (mostly taken from the field manuals) and all trees below that threshold are excluded from this analysis. Alaska has some unique allometric equations because of its unique environment. There is a separate database created for CIPHA because of the resolution of measurements.

4) Create disturbance csvs
Because we want to remove sudden impact disturbances from our analysis but are interested in how long-term disturbances can be detected, the script "damage_flags.R" creates two separate files. This script takes the "XX_flags_percent.csv" and "XX_cut_percent.csv" from each database and consolidates them into the file "damage_flags.csv" for cut, human, fire, and other disturbances and the file "DID_flags.csv" for disease, insect and drought disturbances.

